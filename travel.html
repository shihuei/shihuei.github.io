<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>埃及 13 天 11 夜：探險與記帳</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-gold: #D4AF37; /* 沙漠金 */
            --primary-gold-dark: #b08d2b;
            --primary-blue: #0F1F38; /* 尼羅河深藍 */
            --bg-warm: #FEFBF4; /* 溫暖米白 */
            --card-bg: rgba(255, 255, 255, 0.95); /* 帶透明度的白卡片 */
            --text-main: #2c3e50;
            --text-light: #666666;
            --accent-green: #27ae60;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-warm);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            /* 添加全站背景：淡淡的埃及象形文字圖案 */
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4af37' fill-opacity='0.08'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 50px rgba(0,0,0,0.05); /* 讓主內容區塊浮現 */
            background: rgba(255, 255, 255, 0.4); /* 微透明背景 */
        }

        /* --- 1. 頭像與標題區塊 (美化重點) --- */
        .header-section {
            text-align: center;
            padding: 40px 20px 30px;
            position: relative;
            overflow: hidden;
            /* 標題背景：卡通沙漠金字塔向量圖 */
            background-color: var(--primary-blue);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23D4AF37' fill-opacity='0.2' d='M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,224C672,245,768,267,864,261.3C960,256,1056,224,1152,192C1248,160,1344,128,1392,112L1440,96L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z'%3E%3C/path%3E%3Cpath fill='%23D4AF37' fill-opacity='0.4' d='M0,96L48,117.3C96,139,192,181,288,186.7C384,192,480,160,576,149.3C672,139,768,149,864,170.7C960,192,1056,224,1152,218.7C1248,213,1344,171,1392,149.3L1440,128L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z'%3E%3C/path%3E%3C/svg%3E");
            background-size: cover;
            background-position: bottom;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 0 10px 30px rgba(15, 31, 56, 0.15);
            margin-bottom: 30px;
        }

        .avatar-container {
            width: 140px;
            height: 140px;
            margin: 0 auto 15px;
            position: relative;
            z-index: 2;
        }

        .avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 5px solid #fff; /* 白邊讓頭像跳脫背景 */
            object-fit: cover;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            background-color: #ddd;
        }

        .header-section h1 {
            color: #fff; /* 深色背景改用白色文字 */
            font-size: 2rem;
            margin: 10px 0 5px;
            font-weight: 900;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            letter-spacing: 1px;
        }

        .header-section p {
            color: rgba(255,255,255,0.8);
            font-size: 1rem;
            margin: 0;
            font-weight: 500;
        }

        /* --- 2. 儀表板區塊 --- */
        .dashboard-wrapper {
            padding: 0 20px;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .info-card {
            background: var(--card-bg);
            padding: 25px 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
            border: 1px solid rgba(212, 175, 55, 0.15); /* 微弱金邊 */
            backdrop-filter: blur(5px); /* 毛玻璃效果 */
            transition: transform 0.3s;
        }
        .info-card:hover { transform: translateY(-5px); }

        .info-card h3 { margin: 0 0 15px 0; color: var(--text-light); font-size: 0.95rem; font-weight: 600;}

        .weather-box { display: flex; flex-direction: column; align-items: center; }
        .weather-icon {
            font-size: 2.5rem;
            background: linear-gradient(45deg, var(--primary-gold), #f7d77c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
        }
        
        .currency-input {
            width: 100%; box-sizing: border-box;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 12px;
            text-align: center;
            font-size: 1.1rem;
            background: #fcfcfc;
            outline: none;
            transition: all 0.3s;
            color: var(--primary-blue);
            font-weight: bold;
        }
        .currency-input:focus { border-color: var(--primary-gold); background: #fff; }
        .currency-result { margin-top: 12px; font-size: 1.15rem; font-weight: 700; color: var(--primary-blue); }

        /* --- 3. 行程列表區塊 --- */
        .itinerary-wrapper { padding: 0 20px; }
        .itinerary-title {
            display: flex;
            align-items: center;
            margin: 10px 0 20px;
            color: var(--primary-blue);
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(212, 175, 55, 0.2);
        }
        .itinerary-title i { margin-right: 12px; color: var(--primary-gold); font-size: 1.4rem;}
        .itinerary-title h2 { margin:0; font-size: 1.4rem; font-weight: 800; }

        .accordion-item {
            background: var(--card-bg);
            margin-bottom: 15px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .accordion-header {
            padding: 20px 22px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            border-left: 6px solid var(--primary-blue);
            transition: background-color 0.3s;
        }

        .accordion-item.active .accordion-header {
            border-left-color: var(--primary-gold);
            background-color: #fff;
        }
        
        .day-badge {
            background: linear-gradient(135deg, var(--primary-blue), #2c3e50);
            color: #fff;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 700;
            margin-right: 15px;
            min-width: 55px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .accordion-item.active .day-badge {
            background: linear-gradient(135deg, var(--primary-gold), var(--primary-gold-dark));
        }

        .trip-title { font-weight: 700; color: var(--text-main); font-size: 1.05rem; flex: 1; }
        .accordion-icon { color: #ccc; transition: transform 0.3s ease; }
        .accordion-item.active .accordion-icon { transform: rotate(180deg); color: var(--primary-gold); }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background-color: rgba(255,255,255,0.6);
        }

        .content-inner { padding: 25px; border-top: 1px solid #f0f0f0; }

        .details-list { list-style: none; padding: 0; margin: 0 0 25px 0; }
        .details-list li {
            position: relative;
            padding-left: 25px;
            margin-bottom: 14px;
            color: #555;
            font-size: 1rem;
            line-height: 1.7;
        }
        /* 使用金色金字塔圖標代替圓點 */
        .details-list li::before {
            content: "\f66f"; /* FontAwesome landmark icon */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            color: var(--primary-gold);
            position: absolute;
            left: 0;
            top: 2px;
            font-size: 0.85rem;
        }

        .map-link {
            color: var(--primary-gold-dark);
            text-decoration: none;
            font-weight: 700;
            border-bottom: 2px dotted var(--primary-gold);
            transition: all 0.2s;
        }
        .map-link:hover { color: var(--primary-blue); border-bottom-style: solid; background-color: rgba(212, 175, 55, 0.1);}
        .map-link::after {
            content: "\f3c5"; font-family: "Font Awesome 6 Free"; font-weight: 900;
            font-size: 0.9em; margin-left: 4px; color: var(--primary-gold);
        }

        /* --- 記帳區塊美化 --- */
        .spending-section {
            background-color: #F8F9FA;
            border: 2px dashed #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            position: relative;
        }
        /* 記帳區塊背景小圖示 */
        .spending-section::after {
            content: '\f51e'; /* FontAwesome coins */
            font-family: "Font Awesome 6 Free"; font-weight: 900;
            position: absolute; right: 15px; bottom: 10px;
            font-size: 3rem; color: rgba(0,0,0,0.03);
            transform: rotate(-20deg);
        }
        
        .spending-header {
            font-size: 1rem; font-weight: 700;
            color: var(--primary-blue); margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .spending-header i { color: var(--accent-green); margin-right: 8px;}

        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-item, .input-amount {
            padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px;
            font-size: 0.95rem; outline: none; transition: border 0.3s;
        }
        .input-item:focus, .input-amount:focus { border-color: var(--primary-gold); }
        .input-item { flex: 2; } .input-amount { flex: 1; }
        
        .btn-add {
            background: linear-gradient(135deg, var(--primary-gold), var(--primary-gold-dark));
            color: white; border: none; padding: 0 20px; border-radius: 8px;
            cursor: pointer; font-weight: 700; font-size: 1rem;
            box-shadow: 0 4px 10px rgba(212, 175, 55, 0.3);
            transition: transform 0.2s;
        }
        .btn-add:hover { transform: translateY(-2px); }
        .btn-add:active { transform: translateY(0); }

        .expense-list { list-style: none; padding: 0; margin: 0; font-size: 0.9rem; color: #666; }
        .expense-item {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #eee; padding: 8px 0;
        }
        .expense-price { font-weight: 700; color: var(--text-main); }
        .expense-delete {
            color: #e74c3c; cursor: pointer; margin-left: 12px;
            padding: 5px; border-radius: 50%; background: rgba(231, 76, 60, 0.1);
            transition: all 0.2s; font-size: 0.8rem;
        }
        .expense-delete:hover { background: #e74c3c; color: white; }

        /* --- 總結區塊美化 --- */
        .total-summary-wrapper { padding: 20px; }
        .total-summary {
            /* 使用深藍色與金色漸層背景 */
            background: linear-gradient(135deg, var(--primary-blue), #1a2d4d), url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h20v20H0V0zm10 17l-7-7h14l-7 7z' fill='%23D4AF37' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            color: white;
            padding: 30px;
            border-radius: 24px;
            text-align: center;
            box-shadow: 0 15px 30px rgba(15, 31, 56, 0.25);
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(212, 175, 55, 0.3);
        }
        /* 裝飾性光芒 */
        .total-summary::before {
            content: ''; position: absolute; top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.2) 0%, rgba(0,0,0,0) 70%);
            pointer-events: none;
        }

        .total-title { font-size: 1.2rem; margin-bottom: 15px; opacity: 0.9; font-weight: 500; }
        .total-amount-egp {
            font-size: 3rem; font-weight: 900; color: var(--primary-gold);
            line-height: 1; margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .total-amount-twd { font-size: 1.1rem; opacity: 0.8; font-weight: 500; }

        footer {
            margin-top: auto; text-align: center; padding: 40px 0 30px;
            color: var(--primary-blue); font-size: 0.9rem; font-weight: 500;
            opacity: 0.7;
        }
        footer i { color: #e74c3c; }
    </style>
</head>
<body>

    <div class="container">
        
        <div class="header-section">
            <div class="avatar-container">
                <img src="img/family.png" alt="Yu Family" class="avatar">
            </div>
            <h1>埃及古文明探險記</h1>
            <p>13 天 11 夜 • 旅程與花費紀錄</p>
        </div>

        <div class="dashboard-wrapper">
            <div class="dashboard-grid">
                <div class="info-card">
                    <h3>開羅天氣</h3>
                    <div class="weather-box">
                        <i class="fas fa-sun weather-icon"></i>
                        <span style="font-size: 1.8rem; font-weight: 700; color: var(--primary-blue);">26°C</span>
                    </div>
                </div>
                <div class="info-card">
                    <h3>匯率試算 (EGP)</h3>
                    <input type="number" id="egp" class="currency-input" placeholder="輸入埃鎊" oninput="convertCurrency()">
                    <div class="currency-result">
                        <span style="font-size:0.9rem; color:#999;">≈</span> 
                        <span id="twd">0</span> TWD
                    </div>
                </div>
            </div>
        </div>

        <div class="itinerary-wrapper">
            <div class="itinerary-title">
                <i class="fas fa-map-location-dot"></i>
                <h2>每日行程 & 記帳</h2>
            </div>

            <div id="itinerary-list"></div>
        </div>

        <div class="total-summary-wrapper">
            <div class="total-summary">
                <div class="total-title"><i class="fas fa-wallet" style="margin-right:8px; color:var(--primary-gold)"></i>這趟旅程總消費</div>
                <div class="total-amount-egp"><span id="grand-total-egp">0</span> <small style="font-size:1.2rem">EGP</small></div>
                <div class="total-amount-twd">約合 NT$ <span id="grand-total-twd">0</span></div>
                <div style="font-size: 0.75rem; margin-top: 15px; opacity: 0.6;"><i class="fas fa-save"></i> 資料已自動儲存於此設備</div>
            </div>
        </div>

        <footer>
            <p>Made with <i class="fas fa-heart"></i> for your Egypt trip!</p>
        </footer>

    </div>

    <script>
        // --- 設定區 ---
        const RATE = 0.65; // 匯率
        const STORAGE_KEY = 'egypt_trip_expenses_v2'; // 儲存鍵名

        // --- 行程資料 (含地圖連結) ---
        const schedule = [
            { day: "Day 1", title: "抵達埃及 - 初見開羅", content: ["抵達 <a href='https://goo.gl/maps/AbCdeFgHiJk' class='map-link' target='_blank'>開羅國際機場 (CAI)</a>", "專車接送前往市區", "入住 <a href='https://goo.gl/maps/LmNoPqRsTuV' class='map-link' target='_blank'>開羅市區酒店</a>", "於 <a href='https://goo.gl/maps/WXYz12345' class='map-link' target='_blank'>金字塔區</a> 附近散步、欣賞夕陽", "前往當地餐廳享用埃及特色晚餐"] },
            { day: "Day 2", title: "吉薩金字塔 - 飛往亞斯文", content: ["早餐後，前往參觀世界七大奇蹟之一的 <a href='https://goo.gl/maps/PyRaMiDsGiza' class='map-link' target='_blank'>吉薩金字塔群</a> (胡夫、卡夫拉、孟卡拉)", "朝聖守護金字塔千年的 <a href='https://goo.gl/maps/SpHiNx' class='map-link' target='_blank'>人面獅身像</a>", "體驗沙漠騎駱駝，從不同角度欣賞金字塔", "參觀全新的 <a href='https://goo.gl/maps/GrAnDEgyptMu' class='map-link' target='_blank'>大埃及博物館 (GEM)</a>，見證圖坦卡門寶藏", "傍晚前往機場，搭乘國內線飛往 <a href='https://goo.gl/maps/AsWaNAirport' class='map-link' target='_blank'>亞斯文 (Aswan)</a>", "抵達後入住亞斯文飯店"] },
            { day: "Day 3", title: "夜訪阿布辛貝", content: ["上午於亞斯文市區自由活動或飯店休息", "下午集合，搭車穿越沙漠前往 <a href='https://goo.gl/maps/AbUsImBeL' class='map-link' target='_blank'>阿布辛貝 (Abu Simbel)</a> (約3.5小時車程)", "抵達後，參觀氣勢磅礴的 <a href='https://goo.gl/maps/RaMsEsSIITemple' class='map-link' target='_blank'>阿布辛貝神殿</a> (拉美西斯二世神殿與納菲塔莉神殿)", "晚間欣賞震撼的 <a href='https://goo.gl/maps/SoundLightAbu' class='map-link' target='_blank'>神殿聲光秀</a>，感受古埃及的榮耀", "夜宿阿布辛貝當地飯店"] },
            { day: "Day 4", title: "努比亞風情 - 入住郵輪", content: ["清晨再次進入 <a href='https://goo.gl/maps/RaMsEsSIITemple' class='map-link' target='_blank'>阿布辛貝神殿</a>，享受沒有大批遊客的寧靜時刻，迎接日出", "早餐後搭車返回亞斯文", "前往色彩繽紛的 <a href='https://goo.gl/maps/NuBiAnViLlage' class='map-link' target='_blank'>努比亞村</a>，體驗騎駱駝拜訪當地人家", "在尼羅河上體驗搭乘傳統 <a href='https://goo.gl/maps/FeLuCcARide' class='map-link' target='_blank'>風帆船 (Felucca)</a>", "辦理登船手續，今晚入住 <a href='https://goo.gl/maps/NiLeCrUiSe' class='map-link' target='_blank'>尼羅河河輪</a>，開始水上之旅", "在郵輪上享用晚餐並欣賞表演"] },
            { day: "Day 5", title: "菲萊與康翁波", content: ["早餐後，搭乘汽艇前往位於阿吉勒基亞島上的 <a href='https://goo.gl/maps/PhIlAeTeMple' class='map-link' target='_blank'>菲萊神廟 (愛神伊西斯神殿)</a>", "返回郵輪享用午餐，郵輪開始啟航向北", "抵達康翁波 (Kom Ombo)，下船參觀獨特的雙神殿：<a href='https://goo.gl/maps/KoMoMbOTemple' class='map-link' target='_blank'>康翁波神廟</a> (分別供奉鱷魚神索貝克與老鷹神荷魯斯)", "參觀鱷魚木乃伊博物館", "回到郵輪繼續航行，享受尼羅河沿岸風光，晚餐於船上享用"] },
            { day: "Day 6", title: "艾德福與盧克索", content: ["清晨抵達艾德福 (Edfu)，搭乘馬車前往參觀埃及保存最完整的神殿：<a href='https://goo.gl/maps/EdFuTeMple' class='map-link' target='_blank'>艾德福神殿 (荷魯斯神殿)</a>", "返回郵輪享用早餐，郵輪繼續航行，途經伊斯納水閘門", "下午抵達古都 <a href='https://goo.gl/maps/LuXoRCiTy' class='map-link' target='_blank'>盧克索 (Luxor)</a> (古稱底比斯)", "傍晚前往參觀位於市中心的 <a href='https://goo.gl/maps/LuXoRTeMple' class='map-link' target='_blank'>盧克索神殿</a>，欣賞夜間點燈後的神祕氛圍", "晚餐於郵輪上享用，欣賞肚皮舞或旋轉舞表演"] },
            { day: "Day 7", title: "帝王谷與卡納克 - 前往紅海", content: ["早餐後辦理離船手續，前往尼羅河西岸", "參觀法老長眠之地 <a href='https://goo.gl/maps/VaLlEyOfKiNgs' class='map-link' target='_blank'>帝王谷</a>，進入陵墓欣賞精美壁畫", "參觀哈特謝普蘇特女王神殿 (The Mortuary Temple of Hatshepsut)", "途經 <a href='https://goo.gl/maps/MeMnOnCoLoSsi' class='map-link' target='_blank'>曼儂巨像</a> 拍照留念", "返回東岸享用午餐", "下午參觀世界最大的神殿群：<a href='https://goo.gl/maps/KaRnAkTeMple' class='map-link' target='_blank'>卡納克神殿</a>，漫步於壯觀的巨柱廳", "專車前往紅海度假勝地 <a href='https://goo.gl/maps/HuRgHaDaCiTy' class='map-link' target='_blank'>赫爾達格 (Hurghada)</a> (約4小時車程)", "抵達後入住紅海全包式度假飯店，享用晚餐"] },
            { day: "Day 8", title: "赫爾達格自由活動", content: ["全日於赫爾達格自由活動，享受悠閒時光", "推薦活動：參加出海行程，前往 <a href='https://goo.gl/maps/GiFtUnIsLaNd' class='map-link' target='_blank'>基夫頓島 (Giftun Island)</a> 附近海域體驗浮潛或深潛，欣賞紅海豐富的珊瑚礁與熱帶魚", "或者在飯店專屬沙灘享受日光浴、游泳", "盡情享用飯店內的全包式餐飲與設施"] },
            { day: "Day 9", title: "紅海 - 返回開羅", content: ["上午繼續享受飯店設施或參加水上活動 (如：玻璃底船、香蕉船等)", "或者參加刺激的沙漠吉普車飆沙行程，拜訪貝都因人部落", "中午辦理退房，享用午餐", "下午專車前往赫爾達格機場，搭機飛回 <a href='https://goo.gl/maps/CaIrOCiTy' class='map-link' target='_blank'>開羅</a>", "抵達開羅後，前往餐廳享用晚餐", "入住開羅飯店休息"] },
            { day: "Day 10", title: "黑白沙漠探險", content: ["一早搭乘專車離開開羅，前往拜哈里耶綠洲 (Bahariya Oasis)", "換乘四輪傳動吉普車進入沙漠深處", "首先抵達 <a href='https://goo.gl/maps/BlAcKDeSeRt' class='map-link' target='_blank'>黑沙漠</a>，欣賞火山岩覆蓋的黑色沙丘", "接著前往 <a href='https://goo.gl/maps/CrYsTaLMoUnTaIn' class='map-link' target='_blank'>水晶山</a>", "最後抵達 <a href='https://goo.gl/maps/WhItEDeSeRt' class='map-link' target='_blank'>白沙漠</a>，欣賞風化形成的各種奇岩怪石 (如：蘑菇石、小雞石)", "晚上入住沙漠中的星空飯店或體驗沙漠露營，享用貝都因式營火晚餐，欣賞無光害的壯麗星空"] },
            { day: "Day 11", title: "開羅 - 金字塔下午茶", content: ["在沙漠中醒來，欣賞美麗的日出", "享用簡單早餐後，搭車返回開羅市區", "中午抵達開羅，享用午餐", "下午前往位於吉薩金字塔旁的百年歷史飯店 <a href='https://goo.gl/maps/MeNaHoUsEHToEl' class='map-link' target='_blank'>Mena House</a>，在花園中一邊享用英式下午茶，一邊近距離欣賞金字塔美景", "傍晚前往當地市集 (如：哈利利市集) 做最後的採買與逛街", "晚餐後返回飯店休息"] },
            { day: "Day 12", title: "開心返家", content: ["飯店早餐後，整理行囊", "辦理退房手續，專車前往 <a href='https://goo.gl/maps/CaIrOAiRpOrT' class='map-link' target='_blank'>開羅國際機場 (CAI)</a>", "辦理登機與出境手續", "搭乘阿聯酋航空豪華客機經杜拜轉機，帶著滿滿的回憶回到溫暖的家"] }
        ];

        // 讀取 localStorage 中的資料，如果沒有則為空物件
        let expenses = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        const listContainer = document.getElementById('itinerary-list');

        // --- 初始化頁面 ---
        schedule.forEach((item, index) => {
            // 產生行程細節的 HTML 清單
            let listItems = item.content.map(text => `<li>${text}</li>`).join('');

            const div = document.createElement('div');
            div.className = 'accordion-item';
            div.innerHTML = `
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <div style="display:flex; align-items:center; overflow:hidden;">
                        <span class="day-badge">${item.day}</span>
                        <span class="trip-title">${item.title}</span>
                    </div>
                    <i class="fas fa-chevron-down accordion-icon"></i>
                </div>
                <div class="accordion-content">
                    <div class="content-inner">
                        <ul class="details-list">${listItems}</ul>
                        
                        <div class="spending-section">
                            <div class="spending-header">
                                <span><i class="fas fa-coins"></i> 今日消費紀錄</span>
                                <span style="font-weight:900; color:var(--primary-gold-dark)">小計: <span id="day-total-${index}" style="font-size:1.1em">0</span> EGP</span>
                            </div>
                            <div class="input-group">
                                <input type="text" class="input-item" id="item-name-${index}" placeholder="項目 (例如: 午餐)">
                                <input type="number" class="input-amount" id="item-price-${index}" placeholder="金額" inputmode="decimal">
                                <button class="btn-add" onclick="addExpense(${index})"><i class="fas fa-plus"></i> 新增</button>
                            </div>
                            <ul class="expense-list" id="expense-list-${index}">
                                </ul>
                        </div>
                    </div>
                </div>
            `;
            listContainer.appendChild(div);
            
            // 渲染該天的記帳列表
            renderDayExpenses(index);
        });

        // 更新總金額
        updateGrandTotal();

        // --- 功能函數 ---

        // 新增一筆消費
        function addExpense(dayIndex) {
            const nameInput = document.getElementById(`item-name-${dayIndex}`);
            const priceInput = document.getElementById(`item-price-${dayIndex}`);
            const name = nameInput.value.trim();
            const price = parseFloat(priceInput.value);

            if (!name || isNaN(price) || price < 0) {
                alert("請輸入正確的項目名稱和金額");
                return;
            }

            if (!expenses[dayIndex]) expenses[dayIndex] = [];
            expenses[dayIndex].push({ name: name, price: price });
            
            saveData();
            renderDayExpenses(dayIndex);
            updateGrandTotal();

            nameInput.value = '';
            priceInput.value = '';
            nameInput.focus();
        }

        // 刪除一筆消費
        function deleteExpense(dayIndex, itemIndex) {
            // if (confirm("確定要刪除這筆紀錄嗎？")) { // 可以選擇是否要確認提示
                expenses[dayIndex].splice(itemIndex, 1);
                saveData();
                renderDayExpenses(dayIndex);
                updateGrandTotal();
            // }
        }

        // 渲染單日消費列表
        function renderDayExpenses(dayIndex) {
            const listEl = document.getElementById(`expense-list-${dayIndex}`);
            const totalEl = document.getElementById(`day-total-${dayIndex}`);
            
            if (!expenses[dayIndex] || expenses[dayIndex].length === 0) {
                listEl.innerHTML = '<li style="text-align:center; padding:10px 0; color:#aaa; font-style:italic;">尚未有消費紀錄</li>';
                totalEl.innerText = '0';
                return;
            }

            let html = '';
            let dayTotal = 0;

            expenses[dayIndex].forEach((item, idx) => {
                dayTotal += item.price;
                html += `
                    <li class="expense-item">
                        <span>${item.name}</span>
                        <span>
                            <span class="expense-price">${item.price.toLocaleString()}</span> <small>EGP</small>
                            <i class="fas fa-trash-alt expense-delete" onclick="deleteExpense(${dayIndex}, ${idx})"></i>
                        </span>
                    </li>
                `;
            });

            listEl.innerHTML = html;
            totalEl.innerText = dayTotal.toLocaleString();
            
            // 自動調整 Accordion 高度以適應新內容
            const contentDiv = listEl.closest('.accordion-content');
            if (contentDiv.style.maxHeight && contentDiv.style.maxHeight !== '0px') {
                contentDiv.style.maxHeight = contentDiv.scrollHeight + "px";
            }
        }

        // 更新總金額
        function updateGrandTotal() {
            let total = 0;
            Object.values(expenses).forEach(dayList => {
                dayList.forEach(item => total += item.price);
            });

            const grandTotalEgp = document.getElementById('grand-total-egp');
            const grandTotalTwd = document.getElementById('grand-total-twd');
            
            // 加入數字跳動效果 (簡單版)
            animateValue(grandTotalEgp, parseInt(grandTotalEgp.innerText.replace(/,/g, '')) || 0, total, 500);
            animateValue(grandTotalTwd, parseInt(grandTotalTwd.innerText.replace(/,/g, '')) || 0, Math.round(total * RATE), 500);
        }

        // 數字跳動動畫函數
        function animateValue(obj, start, end, duration) {
            if (start === end) return;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerText = Math.floor(progress * (end - start) + start).toLocaleString();
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // 儲存資料到 LocalStorage
        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses));
        }

        // 手風琴開關
        function toggleAccordion(header) {
            const item = header.parentElement;
            const content = header.nextElementSibling;
            
            // 關閉其他已開啟的項目 (若想允許同時開啟多個，註解掉下面這段 IF)
            const currentActive = document.querySelector('.accordion-item.active');
            if(currentActive && currentActive !== item) {
                currentActive.classList.remove('active');
                currentActive.querySelector('.accordion-content').style.maxHeight = null;
            }

            item.classList.toggle('active');
            if (item.classList.contains('active')) {
                content.style.maxHeight = content.scrollHeight + "px";
            } else {
                content.style.maxHeight = null;
            }
        }

        // 匯率轉換
        function convertCurrency() {
            const input = document.getElementById('egp').value;
            const output = document.getElementById('twd');
            if(input && input > 0) {
                output.innerText = Math.round(input * RATE).toLocaleString();
            } else {
                output.innerText = '0';
            }
        }
    </script>
</body>
</html>
