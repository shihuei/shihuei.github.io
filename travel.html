<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>埃及 13 天 11 夜：探險與記帳</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-gold: #D4AF37; 
            --primary-gold-dark: #b08d2b;
            --primary-blue: #0F1F38; 
            --bg-warm: #FEFBF4; 
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-main: #2c3e50;
            --text-light: #666666;
            --danger: #e74c3c;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-warm);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4af37' fill-opacity='0.08'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.4);
        }

        /* --- 1. 頭部區域 --- */
        .header-section {
            text-align: center;
            padding: 40px 20px 30px;
            position: relative;
            background-color: var(--primary-blue);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23D4AF37' fill-opacity='0.2' d='M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,224C672,245,768,267,864,261.3C960,256,1056,224,1152,192C1248,160,1344,128,1392,112L1440,96L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z'%3E%3C/path%3E%3C/svg%3E");
            background-size: cover;
            background-position: bottom;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 0 10px 30px rgba(15, 31, 56, 0.15);
            margin-bottom: 20px;
        }

        .avatar-container {
            width: 130px;
            height: 130px;
            margin: 0 auto 15px;
            position: relative;
            z-index: 2;
        }

        .avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 5px solid #fff;
            object-fit: cover;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            background-color: #ddd;
        }

        .header-section h1 {
            color: #fff;
            font-size: 1.8rem;
            margin: 10px 0 5px;
            font-weight: 900;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .header-section p {
            color: rgba(255,255,255,0.8);
            margin: 0;
            font-size: 0.95rem;
        }

        /* --- 2. 儀表板 --- */
        .dashboard-wrapper { padding: 0 20px; }
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .info-card {
            background: var(--card-bg);
            padding: 20px 15px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .info-card h3 { margin: 0 0 10px 0; color: var(--text-light); font-size: 0.9rem; }

        .weather-icon {
            font-size: 2.2rem;
            background: linear-gradient(45deg, var(--primary-gold), #f7d77c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .currency-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary-blue);
            outline: none;
            background: #f9f9f9;
        }
        .currency-input:focus { border-color: var(--primary-gold); background: #fff; }

        /* --- 3. 行程列表 --- */
        .itinerary-wrapper { padding: 0 20px; }
        .itinerary-title {
            display: flex; align-items: center; margin: 10px 0 20px;
            color: var(--primary-blue); border-bottom: 2px solid rgba(212, 175, 55, 0.2);
            padding-bottom: 10px;
        }
        .itinerary-title i { margin-right: 10px; color: var(--primary-gold); font-size: 1.2rem; }
        .itinerary-title h2 { margin:0; font-size: 1.2rem; font-weight: 800; }

        .accordion-item {
            background: var(--card-bg);
            margin-bottom: 15px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.5);
        }

        .accordion-header {
            padding: 18px 20px;
            cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            border-left: 5px solid var(--primary-blue);
            transition: background 0.2s;
            background: rgba(255,255,255,0.8);
        }
        .accordion-header:active { background: #f0f0f0; }

        .accordion-item.active .accordion-header {
            border-left-color: var(--primary-gold);
            background: #fff;
        }
        
        .day-badge {
            background: var(--primary-blue);
            color: #fff;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-right: 12px;
            min-width: 55px;
            text-align: center;
        }
        .accordion-item.active .day-badge { background: var(--primary-gold); }

        .trip-title { font-weight: 700; color: var(--text-main); font-size: 1rem; flex: 1; }
        .accordion-icon { color: #ccc; transition: transform 0.3s; }
        .accordion-item.active .accordion-icon { transform: rotate(180deg); color: var(--primary-gold); }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background-color: #fff;
        }

        .content-inner { padding: 20px; border-top: 1px solid #eee; }

        .details-list { list-style: none; padding: 0; margin: 0 0 25px 0; }
        .details-list li {
            position: relative;
            padding-left: 22px;
            margin-bottom: 12px;
            color: #555;
            font-size: 0.95rem;
        }
        .details-list li::before {
            content: "\f66f"; font-family: "Font Awesome 6 Free"; font-weight: 900;
            color: var(--primary-gold); position: absolute; left: 0; top: 3px; font-size: 0.8rem;
        }
        .map-link {
            color: var(--primary-gold-dark); text-decoration: none; font-weight: 700;
            border-bottom: 1px dotted var(--primary-gold);
        }

        /* --- 4. 記帳區塊 (手機版修正重點) --- */
        .spending-section {
            background-color: #F8F9FA;
            border: 2px dashed #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            position: relative;
        }
        
        .spending-header {
            font-size: 0.95rem; font-weight: 700;
            color: var(--primary-blue); margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* 修正：輸入框群組 */
        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .input-item {
            flex: 2; /* 預設佔比 */
            padding: 10px; border: 1px solid #ddd; border-radius: 8px;
            font-size: 0.95rem; outline: none; -webkit-appearance: none;
        }
        .input-amount {
            flex: 1; /* 預設佔比 */
            padding: 10px; border: 1px solid #ddd; border-radius: 8px;
            font-size: 0.95rem; outline: none; -webkit-appearance: none;
        }
        
        .btn-add {
            background: var(--primary-gold);
            color: white; border: none; padding: 0 15px; border-radius: 8px;
            cursor: pointer; font-weight: 700; white-space: nowrap;
        }

        /* Mobile Responsive for Inputs: 修正手機破圖 */
        @media (max-width: 480px) {
            .input-group {
                flex-wrap: wrap; /* 允許換行 */
            }
            .input-item {
                min-width: 100%; /* 手機上名稱佔滿整行 */
                margin-bottom: 5px;
            }
            .input-amount {
                flex-grow: 1; /* 金額佔滿剩餘空間 */
            }
            .btn-add {
                flex-grow: 0;
                padding: 10px 20px; /* 按鈕加大 */
            }
        }

        /* 修正：刪除按鈕列表 */
        .expense-list { list-style: none; padding: 0; margin: 0; font-size: 0.9rem; color: #666; }
        .expense-item {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #eee; padding: 10px 0;
        }
        
        /* 修正：更明顯的刪除按鈕 */
        .btn-delete {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent; /* 移除點擊時的藍框 */
        }
        .btn-delete:active { background: var(--danger); color: white; }
        .btn-delete i { pointer-events: none; /* 讓點擊穿透圖標直接觸發按鈕 */ }

        /* --- 5. 總結區塊 --- */
        .total-summary-wrapper { padding: 20px; padding-bottom: 40px;}
        .total-summary {
            background: linear-gradient(135deg, var(--primary-blue), #1a2d4d);
            color: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 30px rgba(15, 31, 56, 0.25);
            border: 2px solid rgba(212, 175, 55, 0.3);
        }

        .total-amount-egp {
            font-size: 2.5rem; font-weight: 900; color: var(--primary-gold);
            line-height: 1; margin: 10px 0;
        }
        .total-amount-twd { font-size: 1rem; opacity: 0.8; }

        footer {
            margin-top: auto; text-align: center; padding: 0 0 30px;
            color: #999; font-size: 0.8rem;
        }
    </style>
</head>
<body>

    <div class="container">
        
        <div class="header-section">
            <div class="avatar-container">
                <img src="img/family.png" alt="User Avatar" class="avatar">
            </div>
            <h1>埃及古文明探險</h1>
            <p>13 天 11 夜 • 隨身行程與記帳本</p>
        </div>

        <div class="dashboard-wrapper">
            <div class="dashboard-grid">
                <div class="info-card">
                    <h3>開羅天氣</h3>
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <i class="fas fa-sun weather-icon"></i>
                        <span style="font-size: 1.6rem; font-weight: 700; color: var(--primary-blue);">26°C</span>
                    </div>
                </div>
                <div class="info-card">
                    <h3>匯率試算 (EGP)</h3>
                    <input type="number" id="egp" class="currency-input" placeholder="輸入埃鎊" oninput="convertCurrency()">
                    <div style="margin-top:8px; font-weight:bold; color:var(--primary-blue)">
                        ≈ <span id="twd">0</span> TWD
                    </div>
                </div>
            </div>
        </div>

        <div class="itinerary-wrapper">
            <div class="itinerary-title">
                <i class="fas fa-map-location-dot"></i>
                <h2>每日行程 & 記帳</h2>
            </div>
            <div id="itinerary-list"></div>
        </div>

        <div class="total-summary-wrapper">
            <div class="total-summary">
                <div style="font-size:1.1rem; opacity:0.9">旅程總消費</div>
                <div class="total-amount-egp"><span id="grand-total-egp">0</span> <span style="font-size:1rem">EGP</span></div>
                <div class="total-amount-twd">約合 NT$ <span id="grand-total-twd">0</span></div>
                <div style="font-size: 0.75rem; margin-top: 15px; opacity: 0.5;">
                    <i class="fas fa-check-circle"></i> 資料已自動儲存
                </div>
            </div>
        </div>

        <footer>
            Built for Egypt Trip
        </footer>
    </div>

    <script>
        const RATE = 0.65; 
        const STORAGE_KEY = 'egypt_trip_v3';

        const schedule = [
            { day: "Day 1", title: "抵達埃及 - 初見開羅", content: ["抵達 <a href='https://goo.gl/maps/AbCdeFgHiJk' class='map-link' target='_blank'>開羅國際機場 (CAI)</a>", "專車接送前往市區", "入住 <a href='https://goo.gl/maps/LmNoPqRsTuV' class='map-link' target='_blank'>開羅市區酒店</a>", "於 <a href='https://goo.gl/maps/WXYz12345' class='map-link' target='_blank'>金字塔區</a> 附近散步、欣賞夕陽", "前往當地餐廳享用埃及特色晚餐"] },
            { day: "Day 2", title: "吉薩金字塔 - 飛往亞斯文", content: ["早餐後，前往參觀世界七大奇蹟之一的 <a href='https://goo.gl/maps/PyRaMiDsGiza' class='map-link' target='_blank'>吉薩金字塔群</a>", "朝聖 <a href='https://goo.gl/maps/SpHiNx' class='map-link' target='_blank'>人面獅身像</a>", "體驗沙漠騎駱駝", "參觀 <a href='https://goo.gl/maps/GrAnDEgyptMu' class='map-link' target='_blank'>大埃及博物館 (GEM)</a>", "搭機飛往 <a href='https://goo.gl/maps/AsWaNAirport' class='map-link' target='_blank'>亞斯文 (Aswan)</a>"] },
            { day: "Day 3", title: "夜訪阿布辛貝", content: ["上午於亞斯文市區自由活動", "搭車穿越沙漠前往 <a href='https://goo.gl/maps/AbUsImBeL' class='map-link' target='_blank'>阿布辛貝</a>", "參觀 <a href='https://goo.gl/maps/RaMsEsSIITemple' class='map-link' target='_blank'>阿布辛貝神殿</a>", "晚間欣賞 <a href='https://goo.gl/maps/SoundLightAbu' class='map-link' target='_blank'>神殿聲光秀</a>"] },
            { day: "Day 4", title: "努比亞風情 - 入住郵輪", content: ["清晨再次進入神殿，享受寧靜時刻", "返回亞斯文，前往 <a href='https://goo.gl/maps/NuBiAnViLlage' class='map-link' target='_blank'>努比亞村</a>", "體驗搭乘 <a href='https://goo.gl/maps/FeLuCcARide' class='map-link' target='_blank'>風帆船 (Felucca)</a>", "入住 <a href='https://goo.gl/maps/NiLeCrUiSe' class='map-link' target='_blank'>尼羅河河輪</a>"] },
            { day: "Day 5", title: "菲萊與康翁波", content: ["參觀 <a href='https://goo.gl/maps/PhIlAeTeMple' class='map-link' target='_blank'>菲萊神廟</a>", "遊輪航行", "抵達康翁波，參觀 <a href='https://goo.gl/maps/KoMoMbOTemple' class='map-link' target='_blank'>康翁波神廟 (雙神殿)</a>"] },
            { day: "Day 6", title: "艾德福與盧克索", content: ["搭乘馬車參觀 <a href='https://goo.gl/maps/EdFuTeMple' class='map-link' target='_blank'>艾德福神殿</a>", "遊輪經伊斯納水閘門", "抵達 <a href='https://goo.gl/maps/LuXoRCiTy' class='map-link' target='_blank'>盧克索</a>", "夜遊 <a href='https://goo.gl/maps/LuXoRTeMple' class='map-link' target='_blank'>盧克索神殿</a>"] },
            { day: "Day 7", title: "帝王谷與卡納克", content: ["前往西岸參觀 <a href='https://goo.gl/maps/VaLlEyOfKiNgs' class='map-link' target='_blank'>帝王谷</a>", "參觀哈特謝普蘇特女王神殿", "拍照留念 <a href='https://goo.gl/maps/MeMnOnCoLoSsi' class='map-link' target='_blank'>曼儂巨像</a>", "下午參觀東岸 <a href='https://goo.gl/maps/KaRnAkTeMple' class='map-link' target='_blank'>卡納克神殿</a>", "專車前往 <a href='https://goo.gl/maps/HuRgHaDaCiTy' class='map-link' target='_blank'>赫爾達格 (紅海)</a>"] },
            { day: "Day 8", title: "赫爾達格自由活動", content: ["全日自由活動", "推薦：出海前往 <a href='https://goo.gl/maps/GiFtUnIsLaNd' class='map-link' target='_blank'>基夫頓島</a> 浮潛", "享受飯店全包式設施"] },
            { day: "Day 9", title: "紅海 - 返回開羅", content: ["享受水上活動或沙漠吉普車", "傍晚搭機飛回 <a href='https://goo.gl/maps/CaIrOCiTy' class='map-link' target='_blank'>開羅</a>", "入住開羅飯店"] },
            { day: "Day 10", title: "黑白沙漠探險", content: ["專車前往拜哈里耶綠洲", "探索 <a href='https://goo.gl/maps/BlAcKDeSeRt' class='map-link' target='_blank'>黑沙漠</a> 與 <a href='https://goo.gl/maps/WhItEDeSeRt' class='map-link' target='_blank'>白沙漠</a>", "夜宿沙漠星空飯店或露營"] },
            { day: "Day 11", title: "開羅 - 金字塔下午茶", content: ["欣賞沙漠日出後返回開羅", "於 <a href='https://goo.gl/maps/MeNaHoUsEHToEl' class='map-link' target='_blank'>Mena House</a> 享用金字塔景觀下午茶", "逛哈利利市集"] },
            { day: "Day 12", title: "開心返家", content: ["前往 <a href='https://goo.gl/maps/CaIrOAiRpOrT' class='map-link' target='_blank'>開羅機場</a>", "搭乘阿聯酋航空返家"] }
        ];

        let expenses = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        const listContainer = document.getElementById('itinerary-list');

        function init() {
            schedule.forEach((item, index) => {
                let listItems = item.content.map(text => `<li>${text}</li>`).join('');

                const div = document.createElement('div');
                div.className = 'accordion-item';
                div.innerHTML = `
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <div style="display:flex; align-items:center; overflow:hidden;">
                            <span class="day-badge">${item.day}</span>
                            <span class="trip-title">${item.title}</span>
                        </div>
                        <i class="fas fa-chevron-down accordion-icon"></i>
                    </div>
                    <div class="accordion-content">
                        <div class="content-inner">
                            <ul class="details-list">${listItems}</ul>
                            
                            <div class="spending-section">
                                <div class="spending-header">
                                    <span><i class="fas fa-coins"></i> 消費紀錄</span>
                                    <span>小計: <span id="day-total-${index}">0</span> EGP</span>
                                </div>
                                <div class="input-group">
                                    <input type="text" class="input-item" id="item-name-${index}" placeholder="項目 (如:午餐)">
                                    <input type="number" class="input-amount" id="item-price-${index}" placeholder="金額" inputmode="decimal">
                                    <button class="btn-add" type="button" onclick="addExpense(${index})">新增</button>
                                </div>
                                <ul class="expense-list" id="expense-list-${index}"></ul>
                            </div>
                        </div>
                    </div>
                `;
                listContainer.appendChild(div);
                renderDayExpenses(index);
            });
            updateGrandTotal();
        }

        function addExpense(dayIndex) {
            const nameInput = document.getElementById(`item-name-${dayIndex}`);
            const priceInput = document.getElementById(`item-price-${dayIndex}`);
            const name = nameInput.value.trim();
            const price = parseFloat(priceInput.value);

            if (!name || isNaN(price) || price < 0) {
                alert("請填寫正確項目與金額");
                return;
            }

            if (!expenses[dayIndex]) expenses[dayIndex] = [];
            expenses[dayIndex].push({ name: name, price: price });
            
            saveData();
            renderDayExpenses(dayIndex);
            updateGrandTotal();

            nameInput.value = '';
            priceInput.value = '';
        }

        // 將 deleteExpense 設為全域函數，確保 onclick 能呼叫到
        window.deleteExpense = function(dayIndex, itemIndex) {
            if (confirm("確定刪除？")) {
                expenses[dayIndex].splice(itemIndex, 1);
                saveData();
                renderDayExpenses(dayIndex);
                updateGrandTotal();
            }
        };

        function renderDayExpenses(dayIndex) {
            const listEl = document.getElementById(`expense-list-${dayIndex}`);
            const totalEl = document.getElementById(`day-total-${dayIndex}`);
            
            if (!expenses[dayIndex] || expenses[dayIndex].length === 0) {
                listEl.innerHTML = '<li style="text-align:center; padding:10px 0; color:#aaa; font-size:0.85rem;">尚無紀錄</li>';
                totalEl.innerText = '0';
                return;
            }

            let html = '';
            let dayTotal = 0;

            expenses[dayIndex].forEach((item, idx) => {
                dayTotal += item.price;
                html += `
                    <li class="expense-item">
                        <span style="font-weight:500;">${item.name}</span>
                        <div style="display:flex; align-items:center;">
                            <span style="font-weight:700; color:var(--text-main);">${item.price.toLocaleString()}</span>
                            <span style="font-size:0.8rem; margin-left:3px;">EGP</span>
                            <button class="btn-delete" type="button" onclick="deleteExpense(${dayIndex}, ${idx})">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </li>
                `;
            });

            listEl.innerHTML = html;
            totalEl.innerText = dayTotal.toLocaleString();

            const contentDiv = listEl.closest('.accordion-content');
            if (contentDiv.style.maxHeight && contentDiv.style.maxHeight !== '0px') {
                contentDiv.style.maxHeight = contentDiv.scrollHeight + "px";
            }
        }

        function updateGrandTotal() {
            let total = 0;
            Object.values(expenses).forEach(dayList => {
                dayList.forEach(item => total += item.price);
            });
            document.getElementById('grand-total-egp').innerText = total.toLocaleString();
            document.getElementById('grand-total-twd').innerText = Math.round(total * RATE).toLocaleString();
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses));
        }

        function toggleAccordion(header) {
            const item = header.parentElement;
            const content = header.nextElementSibling;
            
            const currentActive = document.querySelector('.accordion-item.active');
            if(currentActive && currentActive !== item) {
                currentActive.classList.remove('active');
                currentActive.querySelector('.accordion-content').style.maxHeight = null;
            }

            item.classList.toggle('active');
            if (item.classList.contains('active')) {
                content.style.maxHeight = content.scrollHeight + "px";
            } else {
                content.style.maxHeight = null;
            }
        }

        function convertCurrency() {
            const val = document.getElementById('egp').value;
            document.getElementById('twd').innerText = val ? Math.round(val * RATE).toLocaleString() : '0';
        }

        init();
    </script>
</body>
</html>
